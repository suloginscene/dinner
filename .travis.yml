language: java
jdk: openjdk11

branches:
  only:
    - dev
    - master

cache:
  directories:
    - $HOME/.m2

before_install:
  - sudo mkdir /dinner-ref
  - sudo mkdir /dinner-ref/app
  - sudo mkdir /dinner-ref/app/logs
  - sudo touch /dinner-ref/app/logs/dinner.log
  - sudo chmod 666 /dinner-ref/app/logs/dinner.log

script:
  - ./mvnw package -DskipTests=true

after_success:
  - docker build -t dinner:latest ./
  - docker tag dinner:latest scenecho/dinner:latest
  - docker tag dinner:latest scenecho/dinner:"$TAG"
  - echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
  - docker push scenecho/dinner:latest
  - docker push scenecho/dinner:"$TAG"

notifications:
  email:
    recipients:
      - suloginscene@gmail.com
