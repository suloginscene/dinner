<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <div th:replace="layout/layout::head(${article.title},~{::link}, ~{})">
        <link rel="stylesheet" href="/css/page/board/article/view.css"/>
    </div>

    <body th:replace="layout/layout::body(~{::section})">
        <section th:object="${article}">

            <div class="info">
                <h2 id="topic"><a th:href="'/topics/'+*{topic.id}" th:text="*{topic.title}"></a></h2>
                <h1 id="title" th:text="*{title}"></h1>
                <div id="sub-info">
                    <span id="writer"><a th:href="'/@'+*{writer}" th:text="*{writer}"></a></span>
                    <span id="date" th:text="*{#temporals.format(createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                </div>
            </div>

            <div id="button-container" sec:authorize="isAuthenticated()">
                <form th:if="${!article.published}and${#authentication.name}==${article.writer}" th:action="'/articles/'+*{id}" method="post">
                    <button type="submit">publish</button>
                </form>
                <form th:if="${#authentication.name}==*{writer}" th:action="'/articles/'+*{id}+'/form'" method="get">
                    <button type="submit">update</button>
                </form>
            </div>

            <article th:utext="*{content}"></article>

            <ul th:each="reply:*{replies}">
                <li>
                    <span><a th:href="@{'/@'+${reply.writer}}" th:text="${reply.writer}"></a></span>
                    <span th:text="${reply.content}"></span>
                    <span th:text="${#temporals.format(reply.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                </li>
            </ul>

            <div sec:authorize="!isAuthenticated()">
                Reply need login.
            </div>
            <div sec:authorize="isAuthenticated()">
                <form th:action="@{/replies}" th:method="post">
                    <span th:text="${#authentication.name}"></span>
                    <label>
                        <input type="text" name="articleId" th:value="*{id}" hidden>
                        <input type="text" name="content" placeholder="reply">
                    </label>
                    <button type="submit">write</button>
                </form>
            </div>

        </section>
    </body>

</html>
